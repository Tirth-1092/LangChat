

{% comment %} <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>LangChat</title>
  <style>
    body { margin:0; display:flex; flex-direction:column; height:100vh; font-family:Arial,sans-serif; }
    header { background:#4A90E2; color:#fff; padding:1rem; text-align:center; }
    #chat-container { display:flex; flex:1; }
    #rooms { width:200px; border-right:1px solid #ccc; overflow-y:auto; }
    #rooms ul { list-style:none; margin:0; padding:0; }
    #rooms li { padding:.5rem; cursor:pointer; }
    #rooms li.active { background:#e6f2ff; }
    #chat { flex:1; display:flex; flex-direction:column; }
    #chatBox { flex:1; padding:1rem; overflow-y:auto; background:#f9f9f9; }

    .message { display:flex; margin-bottom:.5rem; }
    .message.sent     { justify-content:flex-end; }
    .message.received { justify-content:flex-start; }

    .bubble {
      max-width:60%; padding:.5rem 1rem; border-radius:1rem; position:relative;
      word-wrap:break-word;
    }
    .message.sent .bubble     { background:#4A90E2; color:#fff; border-bottom-right-radius:0; }
    .message.received .bubble { background:#333; color:#fff; border-bottom-left-radius:0; }

    .time {
      font-size:.7rem; opacity:.7; position:absolute; bottom:-1.2rem; right:.5rem;
    }

    #input-area { display:flex; border-top:1px solid #ccc; padding:.5rem; }
    #msgInput { flex:1; padding:.5rem; font-size:1rem; }
    #sendBtn  {
      margin-left:.5rem; padding:.5rem 1rem; background:#4A90E2;
      color:#fff; border:none; cursor:pointer; font-size:1rem;
    }
  </style>
</head>
<body>
  <header><h1>LangChat</h1></header>
  <div id="chat-container">
    <div id="rooms"><ul id="roomList"></ul></div>
    <div id="chat">
      <div id="chatBox"></div>
      <div id="input-area">
        <input id="msgInput" placeholder="Type a messageâ€¦" />
        <button id="sendBtn">Send</button>
      </div>
    </div>
  </div>
  <script>
    let socket = null, currentRoom = null;

    // Load rooms
    function listRooms(){
      fetch('/api/rooms/')
        .then(r=>r.json())
        .then(data=>{
          const ul = document.getElementById('roomList');
          ul.innerHTML = '';
          data.forEach(r => {
            const li = document.createElement('li');
            li.textContent = r.name;
            li.onclick = () => joinRoom(r.name, li);
            ul.appendChild(li);
          });
        });
    }

    // Join a room / open WebSocket
    function joinRoom(name, el){
      document.querySelectorAll('#rooms li').forEach(x=>x.classList.remove('active'));
      el.classList.add('active');
      currentRoom = name;
      if(socket) socket.close();

      socket = new WebSocket(`ws://${window.location.host}/ws/chat/${name}/`);
      document.getElementById('chatBox').innerHTML = '';
      document.getElementById('sendBtn').disabled = true;

      socket.onopen = () => {
        console.log("ðŸ”Œ WebSocket connected");
        document.getElementById('sendBtn').disabled = false;
      };
      socket.onerror = e => console.error("WebSocket error:", e);
      socket.onclose = () => console.log("ðŸ”Œ WebSocket closed");

      socket.onmessage = e => {
        console.log("Frame:", e.data);
        const parsed = JSON.parse(e.data);
        console.log("Parsed:", parsed);
        appendBubble(parsed.translation, 'received', parsed.timestamp);
      };
    }

    // Bubble helper
    function appendBubble(text, type, time){
      const msg = document.createElement('div');
      msg.className = `message ${type}`;
      msg.innerHTML = `
        <div class="bubble">
          ${text}
          <span class="time">${time}</span>
        </div>`;
      document.getElementById('chatBox').appendChild(msg);
      document.getElementById('chatBox').scrollTop = 1e9;
    }

    // Send logic
    function sendMessage() {
      const inp = document.getElementById('msgInput');
      const txt = inp.value.trim();
      if(!currentRoom) return alert('Select a language (room) first.');
      if(!txt) return;

      // Show own bubble immediately
      const now = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
      appendBubble(txt, 'sent', now);

      // Send to server
      socket.send(JSON.stringify({ message: txt }));
      inp.value = '';
    }

    document.getElementById('sendBtn').onclick = sendMessage;

    // Trigger send on Enter key press
    document.getElementById('msgInput').addEventListener('keypress', function(event) {
      if (event.key === 'Enter') {
        event.preventDefault();
        document.getElementById('sendBtn').click();
      }
    });

    // Initialize
    listRooms();
  </script>
</body>
</html> {% endcomment %}


{% comment %} 

<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>LangChat</title>
  <style>
    body { margin:0; display:flex; flex-direction:column; height:100vh; font-family:Arial,sans-serif; }
    header { background:#4A90E2; color:#fff; padding:1rem; text-align:center; }
    #chat-container { display:flex; flex:1; }
    #rooms { width:200px; border-right:1px solid #ccc; overflow-y:auto; }
    #rooms ul { list-style:none; margin:0; padding:0; }
    #rooms li { padding:.5rem; cursor:pointer; }
    #rooms li.active { background:#e6f2ff; }
    #chat { flex:1; display:flex; flex-direction:column; }
    #chatBox { flex:1; padding:1rem; overflow-y:auto; background:#f9f9f9; }

    .message { display:flex; margin-bottom:.5rem; }
    .message.sent     { justify-content:flex-end; }
    .message.received { justify-content:flex-start; }

    .bubble {
      max-width:60%; padding:.5rem 1rem; border-radius:1rem; position:relative;
      word-wrap:break-word;
    }
    .message.sent .bubble     { background:#4A90E2; color:#fff; border-bottom-right-radius:0; }
    .message.received .bubble { background:#333; color:#fff; border-bottom-left-radius:0; }

    .time {
      font-size:.7rem; opacity:.7; position:absolute; bottom:-1.2rem; right:.5rem;
    }

    #input-area { display:flex; border-top:1px solid #ccc; padding:.5rem; }
    #msgInput { flex:1; padding:.5rem; font-size:1rem; }
    #sendBtn  {
      margin-left:.5rem; padding:.5rem 1rem; background:#4A90E2;
      color:#fff; border:none; cursor:pointer; font-size:1rem;
    }

    .audio-btn {
      margin-top: 5px;
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1.2rem;
    }
  </style>
</head>
<body>
  <header><h1>LangChat</h1></header>
  <div id="chat-container">
    <div id="rooms"><ul id="roomList"></ul></div>
    <div id="chat">
      <div id="chatBox"></div>
      <div id="input-area">
        <input id="msgInput" placeholder="Type a messageâ€¦" />
        <button id="sendBtn">Send</button>
      </div>
    </div>
  </div>
  <script>
    let socket = null, currentRoom = null;

    // Load rooms
    function listRooms(){
      fetch('/api/rooms/')
        .then(r=>r.json())
        .then(data=>{
          const ul = document.getElementById('roomList');
          ul.innerHTML = '';
          data.forEach(r => {
            const li = document.createElement('li');
            li.textContent = r.name;
            li.onclick = () => joinRoom(r.name, li);
            ul.appendChild(li);
          });
        });
    }

    // Join room
    function joinRoom(name, el){
      document.querySelectorAll('#rooms li').forEach(x=>x.classList.remove('active'));
      el.classList.add('active');
      currentRoom = name;
      if(socket) socket.close();

      socket = new WebSocket(`ws://${window.location.host}/ws/chat/${name}/`);
      document.getElementById('chatBox').innerHTML = '';
      document.getElementById('sendBtn').disabled = true;

      socket.onopen = () => {
        document.getElementById('sendBtn').disabled = false;
      };
      socket.onerror = e => console.error("WebSocket error:", e);
      socket.onclose = () => console.log("ðŸ”Œ WebSocket closed");

      socket.onmessage = e => {
        const parsed = JSON.parse(e.data);
        appendBubble(parsed.original, 'sent', parsed.timestamp, parsed.audio_orig);
        appendBubble(parsed.translation, 'received', parsed.timestamp, parsed.audio_trans);
      };
    }

    // Add message to chat box
    function appendBubble(text, type, time, audioUrl = null){
      const msg = document.createElement('div');
      msg.className = `message ${type}`;
      msg.innerHTML = `
        <div class="bubble">
          ${text}
          <span class="time">${time}</span>
          ${audioUrl ? `
            <div>
              <button class="audio-btn" onclick="playAudio('${audioUrl}')">ðŸ”Š</button>
            </div>
          ` : ''}
        </div>`;
      document.getElementById('chatBox').appendChild(msg);
      document.getElementById('chatBox').scrollTop = 1e9;
    }

    function playAudio(base64Url) {
      const audio = new Audio(base64Url);
      audio.play();
    }

    // Send message
    function sendMessage() {
      const inp = document.getElementById('msgInput');
      const txt = inp.value.trim();
      if(!currentRoom) return alert('Select a language (room) first.');
      if(!txt) return;

      const now = new Date().toLocaleTimeString([], {hour:'2-digit', minute:'2-digit'});
      appendBubble(txt, 'sent', now); // Show immediately (no audio yet)

      socket.send(JSON.stringify({ message: txt }));
      inp.value = '';
    }

    document.getElementById('sendBtn').onclick = sendMessage;
    document.getElementById('msgInput').addEventListener('keypress', function(event) {
      if (event.key === 'Enter') {
        event.preventDefault();
        document.getElementById('sendBtn').click();
      }
    });

    listRooms();
  </script>
</body>
</html> {% endcomment %}

 {% comment %} <!DOCTYPE html>
 <html lang="en">
 <head>
   <meta charset="UTF-8" />
   <meta name="viewport" content="width=device-width,initial-scale=1.0" />
   <title>LangChat</title>
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
   <style>
     body {
       margin: 0;
       display: flex;
       flex-direction: column;
       height: 100vh;
       font-family: Arial, sans-serif;
     }
 
     header {
       background: #4A90E2;
       color: #fff;
       padding: 1rem;
       text-align: center;
     }
 
     #chat-container {
       display: flex;
       flex: 1;
     }
 
     #rooms {
       width: 200px;
       border-right: 1px solid #ccc;
       overflow-y: auto;
     }
 
     #rooms ul {
       list-style: none;
       margin: 0;
       padding: 0;
     }
 
     #rooms li {
       padding: .5rem;
       cursor: pointer;
     }
 
     #rooms li.active {
       background: #e6f2ff;
     }
 
     #chat {
       flex: 1;
       display: flex;
       flex-direction: column;
     }
 
     #chatBox {
       flex: 1;
       padding: 1rem;
       overflow-y: auto;
       background: #f9f9f9;
     }
 
     .message {
       display: flex;
       flex-direction: column;
       align-items: flex-start;
       margin-bottom: .8rem;
       gap: 0.2rem;
     }
 
     .message.sent {
       align-items: flex-end;
     }
 
     .bubble {
       max-width: 60%;
       padding: .5rem 1rem;
       border-radius: 1rem;
       position: relative;
       word-wrap: break-word;
     }
 
     .message.sent .bubble {
       background: #4A90E2;
       color: #fff;
       border-bottom-right-radius: 0;
     }
 
     .message.received .bubble {
       background: #333;
       color: #fff;
       border-bottom-left-radius: 0;
     }
 
     .time {
       font-size: .7rem;
       opacity: .7;
       position: absolute;
       bottom: -1.2rem;
       right: .5rem;
     }
 
     .audio-btn {
       background: none;
       border: none;
       cursor: pointer;
       color: #555;
       font-size: 1.2rem;
     }
 
     .audio-btn:hover {
       color: #000;
     }
 
     #input-area {
       display: flex;
       border-top: 1px solid #ccc;
       padding: .5rem;
     }
 
     #msgInput {
       flex: 1;
       padding: .5rem;
       font-size: 1rem;
     }
 
     #sendBtn {
       margin-left: .5rem;
       padding: .5rem 1rem;
       background: #4A90E2;
       color: #fff;
       border: none;
       cursor: pointer;
       font-size: 1rem;
     }
   </style>
 </head>
 <body>
   <header><h1>LangChat</h1></header>
   <div id="chat-container">
     <div id="rooms"><ul id="roomList"></ul></div>
     <div id="chat">
       <div id="chatBox"></div>
       <div id="input-area">
         <input id="msgInput" placeholder="Type a messageâ€¦" />
         <button id="sendBtn">Send</button>
       </div>
     </div>
   </div>
 
   <script>
     let socket = null, currentRoom = null;
 
     function listRooms() {
       fetch('/api/rooms/')
         .then(r => r.json())
         .then(data => {
           const ul = document.getElementById('roomList');
           ul.innerHTML = '';
           data.forEach(r => {
             const li = document.createElement('li');
             li.textContent = r.name;
             li.onclick = () => joinRoom(r.name, li);
             ul.appendChild(li);
           });
         });
     }
 
     function joinRoom(name, el) {
       document.querySelectorAll('#rooms li').forEach(x => x.classList.remove('active'));
       el.classList.add('active');
       currentRoom = name;
       if (socket) socket.close();
 
       socket = new WebSocket(`ws://${window.location.host}/ws/chat/${name}/`);
       document.getElementById('chatBox').innerHTML = '';
       document.getElementById('sendBtn').disabled = true;
 
       socket.onopen = () => {
         document.getElementById('sendBtn').disabled = false;
       };
       socket.onerror = e => console.error("WebSocket error:", e);
       socket.onclose = () => console.log("ðŸ”Œ WebSocket closed");
 
       socket.onmessage = e => {
         const parsed = JSON.parse(e.data);
         appendBubble(parsed.original, 'sent', parsed.timestamp, parsed.audio_orig);
         appendBubble(parsed.translation, 'received', parsed.timestamp, parsed.audio_trans);
       };
     }
 
     function appendBubble(text, type, time, audioUrl = null) {
       const msg = document.createElement('div');
       msg.className = `message ${type}`;
 
       const bubble = document.createElement('div');
       bubble.className = 'bubble';
       bubble.innerHTML = `${text}<span class="time">${time}</span>`;
       msg.appendChild(bubble);
 
       if (audioUrl) {
         const audioBtn = document.createElement('button');
         audioBtn.className = 'audio-btn';
         audioBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
         audioBtn.onclick = () => playAudio(audioUrl);
         msg.appendChild(audioBtn);
       }
 
       document.getElementById('chatBox').appendChild(msg);
       document.getElementById('chatBox').scrollTop = 1e9;
     }
 
     function playAudio(base64Url) {
       const audio = new Audio(base64Url);
       audio.play();
     }
 
     function sendMessage() {
       const inp = document.getElementById('msgInput');
       const txt = inp.value.trim();
       if (!currentRoom) return alert('Select a language (room) first.');
       if (!txt) return;
 
       const now = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
       appendBubble(txt, 'sent', now); // Show immediately (no audio yet)
 
       socket.send(JSON.stringify({ message: txt }));
       inp.value = '';
     }
 
     document.getElementById('sendBtn').onclick = sendMessage;
     document.getElementById('msgInput').addEventListener('keypress', function (event) {
       if (event.key === 'Enter') {
         event.preventDefault();
         document.getElementById('sendBtn').click();
       }
     });
 
     listRooms();
   </script>
 </body>
 </html> {% endcomment %}
{% comment %} 

 <!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>LangChat</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      margin: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
      font-family: Arial, sans-serif;
    }

    header {
      background: #4A90E2;
      color: #fff;
      padding: 1rem;
      text-align: center;
    }

    #chat-container {
      display: flex;
      flex: 1;
    }

    #rooms {
      width: 200px;
      border-right: 1px solid #ccc;
      overflow-y: auto;
    }

    #rooms ul {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    #rooms li {
      padding: .5rem;
      cursor: pointer;
    }

    #rooms li.active {
      background: #e6f2ff;
    }

    #chat {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    #chatBox {
      flex: 1;
      padding: 1rem;
      overflow-y: auto;
      background: #f9f9f9;
    }

    .message {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      margin-bottom: .8rem;
      gap: 0.2rem;
    }

    .message.sent {
      align-items: flex-end;
    }

    .bubble {
      max-width: 60%;
      padding: .5rem 1rem;
      border-radius: 1rem;
      position: relative;
      word-wrap: break-word;
    }

    .message.sent .bubble {
      background: #4A90E2;
      color: #fff;
      border-bottom-right-radius: 0;
    }

    .message.received .bubble {
      background: #333;
      color: #fff;
      border-bottom-left-radius: 0;
    }

    .audio-btn {
      background: none;
      border: none;
      cursor: pointer;
      color: #555;
      font-size: 1.2rem;
    }

    .audio-btn:hover {
      color: #000;
    }

    .time {
      font-size: .75rem;
      color: black;
    }

    #input-area {
      display: flex;
      border-top: 1px solid #ccc;
      padding: .5rem;
    }

    #msgInput {
      flex: 1;
      padding: .5rem;
      font-size: 1rem;
    }

    #sendBtn {
      margin-left: .5rem;
      padding: .5rem 1rem;
      background: #4A90E2;
      color: #fff;
      border: none;
      cursor: pointer;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <header><h1>LangChat</h1></header>
  <div id="chat-container">
    <div id="rooms"><ul id="roomList"></ul></div>
    <div id="chat">
      <div id="chatBox"></div>
      <div id="input-area">
        <input id="msgInput" placeholder="Type a messageâ€¦" />
        <button id="sendBtn">Send</button>
      </div>
    </div>
  </div>

  <script>
    let socket = null, currentRoom = null;

    function listRooms() {
      fetch('/api/rooms/')
        .then(r => r.json())
        .then(data => {
          const ul = document.getElementById('roomList');
          ul.innerHTML = '';
          data.forEach(r => {
            const li = document.createElement('li');
            li.textContent = r.name;
            li.onclick = () => joinRoom(r.name, li);
            ul.appendChild(li);
          });
        });
    }

    function joinRoom(name, el) {
      document.querySelectorAll('#rooms li').forEach(x => x.classList.remove('active'));
      el.classList.add('active');
      currentRoom = name;
      if (socket) socket.close();

      socket = new WebSocket(`ws://${window.location.host}/ws/chat/${name}/`);
      document.getElementById('chatBox').innerHTML = '';
      document.getElementById('sendBtn').disabled = true;

      socket.onopen = () => {
        document.getElementById('sendBtn').disabled = false;
      };
      socket.onerror = e => console.error("WebSocket error:", e);
      socket.onclose = () => console.log("ðŸ”Œ WebSocket closed");

      socket.onmessage = e => {
        const parsed = JSON.parse(e.data);
        appendBubble(parsed.translation, 'received', parsed.timestamp, parsed.audio_trans);
      };
    }

    function appendBubble(text, type, time, audioUrl = null) {
      const msg = document.createElement('div');
      msg.className = `message ${type}`;

      const bubble = document.createElement('div');
      bubble.className = 'bubble';
      bubble.textContent = text;
      msg.appendChild(bubble);

      if (audioUrl) {
        const bottomRow = document.createElement('div');
        bottomRow.style.display = 'flex';
        bottomRow.style.alignItems = 'center';
        bottomRow.style.gap = '8px';

        const audioBtn = document.createElement('button');
        audioBtn.className = 'audio-btn';
        audioBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
        audioBtn.onclick = () => playAudio(audioUrl);

        const timeEl = document.createElement('span');
        timeEl.className = 'time';
        timeEl.textContent = time;

        bottomRow.appendChild(audioBtn);
        bottomRow.appendChild(timeEl);
        msg.appendChild(bottomRow);
      }

      document.getElementById('chatBox').appendChild(msg);
      document.getElementById('chatBox').scrollTop = 1e9;
    }

    function playAudio(base64Url) {
      const audio = new Audio(base64Url);
      audio.play();
    }

    function sendMessage() {
      const inp = document.getElementById('msgInput');
      const txt = inp.value.trim();
      if (!currentRoom) return alert('Select a language (room) first.');
      if (!txt) return;

      socket.send(JSON.stringify({ message: txt }));
      inp.value = '';
    }

    document.getElementById('sendBtn').onclick = sendMessage;
    document.getElementById('msgInput').addEventListener('keypress', function (event) {
      if (event.key === 'Enter') {
        event.preventDefault();
        document.getElementById('sendBtn').click();
      }
    });

    listRooms();
  </script>
</body>
</html> {% endcomment %}


{% comment %} 
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>LangChat</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      margin: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
      font-family: Arial, sans-serif;
    }

    header {
      background: #4A90E2;
      color: #fff;
      padding: 1rem;
      text-align: center;
    }

    #chat-container {
      display: flex;
      flex: 1;
    }

    #rooms {
      width: 200px;
      border-right: 1px solid #ccc;
      overflow-y: auto;
    }

    #rooms ul {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    #rooms li {
      padding: .5rem;
      cursor: pointer;
    }

    #rooms li.active {
      background: #e6f2ff;
    }

    #chat {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    #chatBox {
      flex: 1;
      padding: 1rem;
      overflow-y: auto;
      background: #f9f9f9;
    }

    .message {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      margin-bottom: .8rem;
      gap: 0.2rem;
    }

    .message.sent {
      align-items: flex-end;
    }

    .bubble {
      max-width: 60%;
      padding: .5rem 1rem;
      border-radius: 1rem;
      position: relative;
      word-wrap: break-word;
    }

    .message.sent .bubble {
      background: #4A90E2;
      color: #fff;
      border-bottom-right-radius: 0;
    }

    .message.received .bubble {
      background: #333;
      color: #fff;
      border-bottom-left-radius: 0;
    }

    .audio-btn {
      background: none;
      border: none;
      cursor: pointer;
      color: #555;
      font-size: 1.2rem;
    }

    .audio-btn:hover {
      color: #000;
    }

    .time {
      font-size: .75rem;
      color: black;
    }

    #input-area {
      display: flex;
      border-top: 1px solid #ccc;
      padding: .5rem;
    }

    #msgInput {
      flex: 1;
      padding: .5rem;
      font-size: 1rem;
    }

    #sendBtn {
      margin-left: .5rem;
      padding: .5rem 1rem;
      background: #4A90E2;
      color: #fff;
      border: none;
      cursor: pointer;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <header><h1>LangChat</h1></header>
  <div id="chat-container">
    <div id="rooms"><ul id="roomList"></ul></div>
    <div id="chat">
      <div id="chatBox"></div>
      <div id="input-area">
        <input id="msgInput" placeholder="Type a messageâ€¦" />
        <button id="sendBtn">Send</button>
      </div>
    </div>
  </div>

  <script>
    let socket = null, currentRoom = null;

    function listRooms() {
      fetch('/api/rooms/')
        .then(r => r.json())
        .then(data => {
          const ul = document.getElementById('roomList');
          ul.innerHTML = '';
          data.forEach(r => {
            const li = document.createElement('li');
            li.textContent = r.name;
            li.onclick = () => joinRoom(r.name, li);
            ul.appendChild(li);
          });
        });
    }

    function joinRoom(name, el) {
      document.querySelectorAll('#rooms li').forEach(x => x.classList.remove('active'));
      el.classList.add('active');
      currentRoom = name;
      if (socket) socket.close();

      socket = new WebSocket(`ws://${window.location.host}/ws/chat/${name}/`);
      document.getElementById('chatBox').innerHTML = '';
      document.getElementById('sendBtn').disabled = true;

      socket.onopen = () => {
        document.getElementById('sendBtn').disabled = false;
      };
      socket.onerror = e => console.error("WebSocket error:", e);
      socket.onclose = () => console.log("ðŸ”Œ WebSocket closed");

      socket.onmessage = e => {
        const parsed = JSON.parse(e.data);
        appendBubble(parsed.translation, 'received', parsed.timestamp, parsed.audio_trans);
      };
    }

    function appendBubble(text, type, time, audioUrl = null) {
      const msg = document.createElement('div');
      msg.className = `message ${type}`;

      const bubble = document.createElement('div');
      bubble.className = 'bubble';
      bubble.textContent = text;
      msg.appendChild(bubble);

      const bottomRow = document.createElement('div');
      bottomRow.style.display = 'flex';
      bottomRow.style.alignItems = 'center';
      bottomRow.style.gap = '8px';

      if (audioUrl) {
        const audioBtn = document.createElement('button');
        audioBtn.className = 'audio-btn';
        audioBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
        audioBtn.onclick = () => playAudio(audioUrl);
        bottomRow.appendChild(audioBtn);
      }

      const timeEl = document.createElement('span');
      timeEl.className = 'time';
      timeEl.textContent = time;
      bottomRow.appendChild(timeEl);

      msg.appendChild(bottomRow);

      document.getElementById('chatBox').appendChild(msg);
      document.getElementById('chatBox').scrollTop = 1e9;
    }

    function playAudio(base64Url) {
      const audio = new Audio(base64Url);
      audio.play();
    }

    function sendMessage() {
      const inp = document.getElementById('msgInput');
      const txt = inp.value.trim();
      if (!currentRoom) return alert('Select a language (room) first.');
      if (!txt) return;

      const now = new Date();
      const time = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

      // Show original message in chat
      appendBubble(txt, 'sent', time);

      socket.send(JSON.stringify({ message: txt }));
      inp.value = '';
    }

    document.getElementById('sendBtn').onclick = sendMessage;
    document.getElementById('msgInput').addEventListener('keypress', function (event) {
      if (event.key === 'Enter') {
        event.preventDefault();
        document.getElementById('sendBtn').click();
      }
    });

    listRooms();
  </script>
</body>
</html> {% endcomment %}
{% comment %} 
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>LangChat</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      margin: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
      font-family: Arial, sans-serif;
    }

    header {
      background: #4A90E2;
      color: #fff;
      padding: 1rem;
      text-align: center;
    }

    #chat-container {
      display: flex;
      flex: 1;
    }

    #rooms {
      width: 200px;
      border-right: 1px solid #ccc;
      overflow-y: auto;
    }

    #rooms ul {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    #rooms li {
      padding: .5rem;
      cursor: pointer;
    }

    #rooms li.active {
      background: #e6f2ff;
    }

    #chat {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    #chatBox {
      flex: 1;
      padding: 1rem;
      overflow-y: auto;
      background: #f9f9f9;
    }

    .message {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      margin-bottom: 1rem;
      gap: 0.4rem;
    }

    .message.sent {
      align-items: flex-end;
    }

    .bubble {
      max-width: 60%;
      padding: .5rem 1rem;
      border-radius: 1rem;
      position: relative;
      word-wrap: break-word;
      background: #f1f1f1;
    }

    .message.sent .bubble {
      background: #4A90E2;
      color: #fff;
      border-bottom-right-radius: 0;
    }

    .message.received .bubble {
      background: #333;
      color: #fff;
      border-bottom-left-radius: 0;
    }

    .audio-btn {
      background: none;
      border: none;
      cursor: pointer;
      color: #555;
      font-size: 1.2rem;
    }

    .audio-btn:hover {
      color: #000;
    }

    .time {
      font-size: .75rem;
      color: black;
    }

    .label {
      font-weight: bold;
      font-size: 0.8rem;
      margin-bottom: 0.2rem;
    }

    #input-area {
      display: flex;
      border-top: 1px solid #ccc;
      padding: .5rem;
    }

    #msgInput {
      flex: 1;
      padding: .5rem;
      font-size: 1rem;
    }

    #sendBtn {
      margin-left: .5rem;
      padding: .5rem 1rem;
      background: #4A90E2;
      color: #fff;
      border: none;
      cursor: pointer;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <header><h1>LangChat</h1></header>
  <div id="chat-container">
    <div id="rooms"><ul id="roomList"></ul></div>
    <div id="chat">
      <div id="chatBox"></div>
      <div id="input-area">
        <input id="msgInput" placeholder="Type a messageâ€¦" />
        <button id="sendBtn">Send</button>
      </div>
    </div>
  </div>

  <script>
    let socket = null, currentRoom = null;

    function listRooms() {
      fetch('/api/rooms/')
        .then(r => r.json())
        .then(data => {
          const ul = document.getElementById('roomList');
          ul.innerHTML = '';
          data.forEach(r => {
            const li = document.createElement('li');
            li.textContent = r.name;
            li.onclick = () => joinRoom(r.name, li);
            ul.appendChild(li);
          });
        });
    }

    function joinRoom(name, el) {
      document.querySelectorAll('#rooms li').forEach(x => x.classList.remove('active'));
      el.classList.add('active');
      currentRoom = name;
      if (socket) socket.close();

      socket = new WebSocket(`ws://${window.location.host}/ws/chat/${name}/`);
      document.getElementById('chatBox').innerHTML = '';
      document.getElementById('sendBtn').disabled = true;

      socket.onopen = () => {
        document.getElementById('sendBtn').disabled = false;
      };
      socket.onerror = e => console.error("WebSocket error:", e);
      socket.onclose = () => console.log("ðŸ”Œ WebSocket closed");

      socket.onmessage = e => {
        const parsed = JSON.parse(e.data);
        const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
        appendBubble(parsed.original, 'received', time, parsed.audio_orig, 'Original');
        appendBubble(parsed.translation, 'received', time, parsed.audio_trans, 'Translation');
      };
    }

    function appendBubble(text, type, time, audioUrl = null, label = '') {
      const msg = document.createElement('div');
      msg.className = `message ${type}`;

      if (label) {
        const lbl = document.createElement('div');
        lbl.className = 'label';
        lbl.textContent = label;
        msg.appendChild(lbl);
      }

      const bubble = document.createElement('div');
      bubble.className = 'bubble';
      bubble.textContent = text;
      msg.appendChild(bubble);

      const bottomRow = document.createElement('div');
      bottomRow.style.display = 'flex';
      bottomRow.style.alignItems = 'center';
      bottomRow.style.gap = '8px';

      if (audioUrl) {
        const audioBtn = document.createElement('button');
        audioBtn.className = 'audio-btn';
        audioBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
        audioBtn.onclick = () => playAudio(audioUrl);
        bottomRow.appendChild(audioBtn);
      }

      const timeEl = document.createElement('span');
      timeEl.className = 'time';
      timeEl.textContent = time;
      bottomRow.appendChild(timeEl);

      msg.appendChild(bottomRow);

      document.getElementById('chatBox').appendChild(msg);
      document.getElementById('chatBox').scrollTop = 1e9;
    }

    function playAudio(base64Url) {
      const audio = new Audio(base64Url);
      audio.play();
    }

    function sendMessage() {
      const inp = document.getElementById('msgInput');
      const txt = inp.value.trim();
      if (!currentRoom) return alert('Select a language (room) first.');
      if (!txt) return;

      const time = new Date().toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

      appendBubble(txt, 'sent', time);

      socket.send(JSON.stringify({ message: txt }));
      inp.value = '';
    }

    document.getElementById('sendBtn').onclick = sendMessage;
    document.getElementById('msgInput').addEventListener('keypress', function (event) {
      if (event.key === 'Enter') {
        event.preventDefault();
        document.getElementById('sendBtn').click();
      }
    });

    listRooms();
  </script>
</body>
</html> {% endcomment %}


<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1.0" />
  <title>LangChat</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <style>
    body {
      margin: 0;
      display: flex;
      flex-direction: column;
      height: 100vh;
      font-family: Arial, sans-serif;
    }

    header {
      background: #4A90E2;
      color: #fff;
      padding: 1rem;
      text-align: center;
    }

    #chat-container {
      display: flex;
      flex: 1;
    }

    #rooms {
      width: 200px;
      border-right: 1px solid #ccc;
      overflow-y: auto;
    }

    #rooms ul {
      list-style: none;
      margin: 0;
      padding: 0;
    }

    #rooms li {
      padding: .5rem;
      cursor: pointer;
    }

    #rooms li.active {
      background: #e6f2ff;
    }

    #chat {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    #chatBox {
      flex: 1;
      padding: 1rem;
      overflow-y: auto;
      background: #f9f9f9;
    }

    .message {
      display: flex;
      flex-direction: column;
      align-items: flex-start;
      margin-bottom: .8rem;
      gap: 0.2rem;
    }

    .message.sent {
      align-items: flex-end;
    }

    .bubble {
      max-width: 60%;
      padding: .5rem 1rem;
      border-radius: 1rem;
      position: relative;
      word-wrap: break-word;
    }

    .message.sent .bubble {
      background: #4A90E2;
      color: #fff;
      border-bottom-right-radius: 0;
    }

    .message.received .bubble {
      background: #333;
      color: #fff;
      border-bottom-left-radius: 0;
    }

    .audio-btn {
      background: none;
      border: none;
      cursor: pointer;
      color: #555;
      font-size: 1.2rem;
    }

    .audio-btn:hover {
      color: #000;
    }

    .time {
      font-size: .75rem;
      color: black;
    }

    #input-area {
      display: flex;
      border-top: 1px solid #ccc;
      padding: .5rem;
    }

    #msgInput {
      flex: 1;
      padding: .5rem;
      font-size: 1rem;
    }

    #sendBtn {
      margin-left: .5rem;
      padding: .5rem 1rem;
      background: #4A90E2;
      color: #fff;
      border: none;
      cursor: pointer;
      font-size: 1rem;
    }
  </style>
</head>
<body>
  <header><h1>LangChat</h1></header>
  <div id="chat-container">
    <div id="rooms"><ul id="roomList"></ul></div>
    <div id="chat">
      <div id="chatBox"></div>
      <div id="input-area">
        <input id="msgInput" placeholder="Type a messageâ€¦" />
        <button id="sendBtn">Send</button>
      </div>
    </div>
  </div>

  <script>
    let socket = null, currentRoom = null;

    function listRooms() {
      fetch('/api/rooms/')
        .then(r => r.json())
        .then(data => {
          const ul = document.getElementById('roomList');
          ul.innerHTML = '';
          data.forEach(r => {
            const li = document.createElement('li');
            li.textContent = r.name;
            li.onclick = () => joinRoom(r.name, li);
            ul.appendChild(li);
          });
        });
    }

    function joinRoom(name, el) {
      document.querySelectorAll('#rooms li').forEach(x => x.classList.remove('active'));
      el.classList.add('active');
      currentRoom = name;
      if (socket) socket.close();

      socket = new WebSocket(`ws://${window.location.host}/ws/chat/${name}/`);
      document.getElementById('chatBox').innerHTML = '';
      document.getElementById('sendBtn').disabled = true;

      socket.onopen = () => {
        document.getElementById('sendBtn').disabled = false;
      };
      socket.onerror = e => console.error("WebSocket error:", e);
      socket.onclose = () => console.log("ðŸ”Œ WebSocket closed");

      socket.onmessage = e => {
        const parsed = JSON.parse(e.data);

        appendBubble(parsed.original, 'sent', parsed.timestamp, parsed.audio_orig);
        appendBubble(parsed.translation, 'received', parsed.timestamp, parsed.audio_trans);
      };
    }

    function appendBubble(text, type, time, audioUrl = null) {
      const msg = document.createElement('div');
      msg.className = `message ${type}`;

      const bubble = document.createElement('div');
      bubble.className = 'bubble';
      bubble.textContent = text;
      msg.appendChild(bubble);

      const bottomRow = document.createElement('div');
      bottomRow.style.display = 'flex';
      bottomRow.style.alignItems = 'center';
      bottomRow.style.gap = '8px';

      if (audioUrl) {
        const audioBtn = document.createElement('button');
        audioBtn.className = 'audio-btn';
        audioBtn.innerHTML = '<i class="fas fa-volume-up"></i>';
        audioBtn.onclick = () => playAudio(audioUrl);
        bottomRow.appendChild(audioBtn);
      }

      const timeEl = document.createElement('span');
      timeEl.className = 'time';
      timeEl.textContent = time;
      bottomRow.appendChild(timeEl);

      msg.appendChild(bottomRow);
      document.getElementById('chatBox').appendChild(msg);
      document.getElementById('chatBox').scrollTop = 1e9;
    }

    function playAudio(base64Url) {
      const audio = new Audio(base64Url);
      audio.play();
    }

    function sendMessage() {
      const inp = document.getElementById('msgInput');
      const txt = inp.value.trim();
      if (!currentRoom) return alert('Select a language (room) first.');
      if (!txt) return;

      socket.send(JSON.stringify({ message: txt }));
      inp.value = '';
    }

    document.getElementById('sendBtn').onclick = sendMessage;
    document.getElementById('msgInput').addEventListener('keypress', function (event) {
      if (event.key === 'Enter') {
        event.preventDefault();
        document.getElementById('sendBtn').click();
      }
    });

    listRooms();
  </script>
</body>
</html>
